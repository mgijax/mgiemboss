#!/bin/sh
#
# This script constantely checks the number
# of files generated by the webservice soaplab
# and remove temp files before their number
# exceed the maximum number of files limit  
#
cd `dirname $0`; . ../Configuration

temp_files_dir=$soaplab2_tempfiles_dir #=/data/../soaplab2/_R_
build_dir=$soaplab2_build_dir         #/data/../soaplab2
archive_dir=$soaplab2_build_dir/archives
rdate=`date +%Y-%m-%d`
zip_file=$archive_dir/soaplab2.tempfiles.$rdate.zip
SCRIPT_NAME=`basename $0`
LOG_DIR=$logdir
LOG=${LOG_DIR}/${SCRIPT_NAME}.log
rm -f ${LOG}
touch ${LOG}
echo "$0" |tee -a  ${LOG}
file_count=`ls $temp_files_dir/* | wc -l` 
echo "$rdate - The Number of files under $temp_files_dir/ is : $file_count" |tee -a ${LOG}
echo "Generating $zip_file zip file for archive" |tee -a ${LOG}
zip -r $zip_file $temp_files_dir 2>&1 | tee -a  ${LOG}
rm -rf $temp_files_dir/* 2>&1 | tee -a ${LOG}
if [ $? -ne 0 ]
then
    echo "Program Failed - check logs $LOG" |tee -a ${LOG}
    exit 1
else
    echo "Program complete - check logs $LOG" |tee -a ${LOG}
    exit 0
fi
